{"version":3,"sources":["../../js/Game.js"],"names":[],"mappings":"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","file":"Game.js","sourcesContent":["// The function onload is loaded when the DOM has been loaded\r\nwindow.addEventListener(\"DOMContentLoaded\", function() {\r\n    new Game('gamecanvas');\r\n    // TODO GAME LAUNCHED TWICE\r\n});\r\n\r\n\r\nclass Game {\r\n    constructor(canvasId) {\r\n\r\n        let canvas          = document.getElementById(canvasId);\r\n        this.engine         = new BABYLON.Engine(canvas, true);\r\n\r\n        // Contains all loaded assets needed for this state\r\n        this.assets  = [];\r\n\r\n        // The state scene\r\n        this.scene   = null;\r\n\r\n        this.gui = new Gui(this);\r\n        this.mouse = new MouseHandler(this);\r\n        // Contains the x lines of the game\r\n        this.lines = [];\r\n\r\n        // Contains all towers in the battlefield\r\n        this.towers = [];\r\n\r\n        // The wave manager of this game: send enemies\r\n        this.wave = new WaveManager(this);\r\n\r\n        // The total gold available to the player\r\n        this._gold = 100;\r\n\r\n        // The configuration object of the game\r\n        this.config = new Config();\r\n\r\n        // Tower builder peasant\r\n        this.towerFactory = new TowerFactory(this);\r\n\r\n        // Resize window event\r\n        window.addEventListener(\"resize\", () => {\r\n            this.engine.resize();\r\n        });\r\n        this.run();\r\n\r\n    }\r\n    _initScene() {\r\n\r\n        let scene = new BABYLON.Scene(this.engine);\r\n        // Camera attached to the canvas\r\n        let camera= new BABYLON.FreeCamera(\"cam\", new BABYLON.Vector3(4.4, 8, -2.5), scene);\r\n        camera.rotation = new BABYLON.Vector3(1, 0, 0);\r\n        camera.attachControl(this.engine.getRenderingCanvas());\r\n\r\n        // Hemispheric light to light the scene\r\n        let h = new BABYLON.HemisphericLight(\"hemi\", new BABYLON.Vector3(0,1,0), scene);\r\n        h.intensity = 0.9;\r\n        return scene;\r\n    }\r\n\r\n    run() {\r\n\r\n        this.scene = this._initScene();\r\n\r\n        // The loader\r\n        let loader =  new BABYLON.AssetsManager(this.scene);\r\n\r\n        //    var meshTask = this.loader.addMeshTask(\"skull task\", \"\", \"./assets/\", \"block02.babylon\");\r\n        //    meshTask.onSuccess = this._initMesh;\r\n\r\n        loader.onFinish = () => {\r\n\r\n            // Init the game\r\n            this._initGame();\r\n\r\n            // The state is ready to be played\r\n            this.isReady = true;\r\n\r\n            this.engine.runRenderLoop(() => {\r\n                this.scene.render();\r\n            });\r\n        };\r\n\r\n        loader.load();\r\n    }\r\n\r\n    _initGame() {\r\n\r\n        // Create ground\r\n        let plane = BABYLON.Mesh.CreateGround(\"ground\", 25, 25, 1, this.scene);\r\n        plane.material = new BABYLON.StandardMaterial(\"\", this.scene);\r\n        plane.material.specularColor = BABYLON.Color3.Black();\r\n        plane.material.diffuseTexture = new BABYLON.Texture(\"assets/ground.jpg\", this.scene);\r\n        plane.material.diffuseTexture.uScale = plane.material.diffuseTexture.vScale = 10;\r\n        plane.material.zOffset = 1;\r\n\r\n\r\n        let pos = BABYLON.Vector3.Zero();\r\n        for (let l=0; l<5; l++) {\r\n            this.lines.push(new Line(this, 10, pos));\r\n            pos.z += 1;\r\n        }\r\n\r\n\r\n        this.updateGui();\r\n        window.addEventListener(\"keydown\", (evt) => {\r\n            if (evt.keyCode == 32) {\r\n                if (this.scene.debugLayer._enabled) {\r\n                    this.scene.debugLayer.hide();\r\n                } else {\r\n                    this.scene.debugLayer.show();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a tower if enough gold. The given parameter is the tower name,\r\n     * to be link with the config object\r\n     */\r\n    createTower(name) {\r\n\r\n        let t = this.towerFactory.build(name);\r\n         // Check if player can buy this tower\r\n        if (t && this._gold - t.cost >= 0) {\r\n            // Create tower\r\n            t.init();\r\n\r\n            // Decrease gold amount\r\n            this.towers.push(t);\r\n            this.gold -= t.cost;\r\n\r\n            // Make tower follow mouse cursor\r\n            this.mouse.followMouse = t;\r\n        } else {\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Returns the nearest cell position from the given world position\r\n     */\r\n    getNearestCell(worldPosition) {\r\n        let min = this.lines[0].cells[0]; // minimum is the first cell by default\r\n        let mindist = BABYLON.Vector3.DistanceSquared(min.position, worldPosition);\r\n\r\n\r\n        for (let l of this.lines) {\r\n            for (let c of l.cells) {\r\n                let currentMinDist = BABYLON.Vector3.DistanceSquared(c.position, worldPosition);\r\n                if ( currentMinDist <= mindist) {\r\n                    mindist = currentMinDist;\r\n                    min = c;\r\n                }\r\n            }\r\n        }\r\n        return min;\r\n    }\r\n\r\n    sendWave() {\r\n        this.wave.sendWave();\r\n    }\r\n\r\n    /**\r\n     * Returns a random line z position\r\n     */\r\n    getRandomLine() {\r\n        let randomNumber = function (min, max) {\r\n            if (min === max) {\r\n                return (min);\r\n            }\r\n            var random = Math.random();\r\n            return Math.floor(((random * (max - min)) + min));\r\n        };\r\n\r\n        return this.lines[randomNumber(0, this.lines.length)];\r\n    }\r\n\r\n    /**\r\n     * Returns the line corresponding to the given id\r\n     */\r\n    getLineById(id) {\r\n        for (let l of this.lines) {\r\n            if (id == l.id) {\r\n                return l;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Update the GUI\r\n     */\r\n    updateGui() {\r\n        this.gui.refresh();\r\n    }\r\n\r\n    /*** GETTER SETTER **/\r\n    get gold() {\r\n        return this._gold;\r\n    }\r\n    set gold(value) {\r\n        this._gold = value;\r\n        this.updateGui();\r\n    }\r\n}\r\n"]}